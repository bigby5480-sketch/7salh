<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">

<!-- ===== PWA ===== -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="7salh">

<title>الرئيسية</title>

<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial;
  height:100vh;
  overflow-y:scroll;
  scroll-snap-type:y mandatory;
}

/* ===== الشريط العلوي ===== */
.top-bar{
  position:fixed;
  top:0;
  right:0;
  left:0;
  height:55px;
  background:#111;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 15px;
  z-index:1000;
  border-bottom:1px solid #222;
}

.balance{ color:#3f8efc; font-weight:bold; }

.user-menu{ position:relative; }
.user-name{ cursor:pointer; display:flex; gap:6px; align-items:center; }
.arrow{ font-size:12px; opacity:.7; }

.dropdown{
  position:absolute;
  top:40px;
  left:0;
  background:#1a1a1a;
  border-radius:8px;
  display:none;
  min-width:160px;
}
.dropdown div{ padding:10px; cursor:pointer; }
.dropdown div:hover{ background:#333; }

/* ===== الفيديوهات ===== */
#videos{ margin-top:55px; }

.video{
  height:100vh;
  scroll-snap-align:start;
  position:relative;
}

iframe{
  width:100%;
  height:100%;
  pointer-events:none;
  object-fit:contain;
  background:black;
}

.tap-layer{ position:absolute; inset:0; z-index:5; }

.delete-btn,.stats-btn{
  position:absolute;
  top:15px;
  z-index:9999;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}

.delete-btn{ left:15px; background:red; color:white; }
.stats-btn{ right:15px; background:#222; color:white; }

.reward-overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  z-index:30;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  cursor:pointer;
}

/* ===== زر الإضافة ===== */
.add-btn{
  position:fixed;
  bottom:20px;
  right:20px;
  width:55px;
  height:55px;
  border-radius:50%;
  background:#3f8efc;
  color:white;
  font-size:30px;
  border:none;
  z-index:1000;
  cursor:pointer;
}

/* ===== المودالات ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  justify-content:center;
  align-items:center;
  z-index:500;
}
.modal-content{
  background:#111;
  padding:20px;
  border-radius:10px;
  width:90%;
  max-width:350px;
}
</style>
</head>

<body>

<!-- الشريط العلوي -->
<div class="top-bar">
  <div class="balance"><span id="balance">0.00</span> ﷼</div>

  <div class="user-menu">
    <div class="user-name" onclick="toggleMenu()">
      <span id="username">مستخدم</span>
      <span class="arrow">▼</span>
    </div>
    <div class="dropdown" id="dropdown">
      <div onclick="goProfile()">معلومات المستخدم</div>
      <div onclick="logout()">تسجيل الخروج</div>
    </div>
  </div>
</div>

<div id="videos"></div>

<button class="add-btn" onclick="openAdd()">＋</button>

<div class="modal" id="addModal">
  <div class="modal-content">
    <h3>إضافة فيديو</h3><br>
    <input id="yt" placeholder="رابط YouTube" style="width:100%"><br><br>
    <button onclick="saveVideo()">حفظ الفيديو</button>
  </div>
</div>

<div class="modal" id="chartModal">
  <div class="modal-content">
    <h3>إحصائيات المشاهدة</h3>
    <canvas id="viewsChart"></canvas><br>
    <button onclick="closeChart()">إغلاق</button>
  </div>
</div>

<!-- ===== Firebase + Logic (كما هو بدون تغيير) ===== -->
<script type="module">
/* كودك كامل بدون أي تعديل */
</script>

<!-- ===== Service Worker ===== -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js");
  });
}
</script>

</body>
</html>
