<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إنشاء حساب</title>

<style>
body {
  font-family: Arial;
  background: #f5f6fa;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.form {
  background: white;
  padding: 25px;
  border-radius: 12px;
  width: 320px;
  box-shadow: 0 10px 30px rgba(0,0,0,.1);
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}

button {
  background: #3f8efc;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="form">
  <h3 style="text-align:center">إنشاء حساب</h3>

  <input id="name" placeholder="الاسم الكامل">
  <input id="email" type="email" placeholder="البريد الإلكتروني">
  <input id="password" type="password" placeholder="كلمة المرور">
  <input id="confirm" type="password" placeholder="إعادة كلمة المرور">

  <select id="age">
    <option value="">الفئة العمرية</option>
    <option>15 - 21</option>
    <option>22 - 28</option>
    <option>29 - 35</option>
    <option>36 - 40</option>
    <option>+40</option>
  </select>

  <!-- ✅ المنطقة موحدة -->
  <select id="region">
    <option value="">اختر المنطقة</option>
    <option value="الشرقية">الشرقية</option>
    <option value="الوسطى">الوسطى</option>
    <option value="الغربية">الغربية</option>
  </select>

  <!-- IBAN -->
  <input id="iban" placeholder="SAxxxxxxxxxxxxxxx" maxlength="17">

  <button onclick="register()">إنشاء الحساب</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyB4tTVOD8P95EUzmOFNkco9AKI0wP1dLW0",
  authDomain: "salh01.firebaseapp.com",
  projectId: "salh01"
});

const auth = getAuth();
const db = getFirestore();

window.register = async () => {
  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const pass = password.value;
  const confirmPass = confirm.value;
  const age = ageSelect.value;
  const region = regionSelect.value;
  let iban = ibanInput.value.trim();

  if (!name || !email || !pass || !confirmPass || !age || !region || !iban) {
    alert("جميع الحقول مطلوبة");
    return;
  }

  if (pass !== confirmPass) {
    alert("كلمتا المرور غير متطابقتين");
    return;
  }

  if (!iban.startsWith("SA") || iban.length !== 17) {
    alert("الآيبان يجب أن يبدأ بـ SA ويحتوي 15 رقمًا");
    return;
  }

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, pass);

    await setDoc(doc(db, "users", cred.user.uid), {
      name,
      email,
      age,
      region,          // ✅ الشرقية / الوسطى / الغربية فقط
      iban,
      balance: 0,
      role: "user",
      createdAt: Date.now()
    });

    location.href = "index.html";
  } catch (e) {
    alert(e.message);
  }
};

const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const password = document.getElementById("password");
const confirm = document.getElementById("confirm");
const ageSelect = document.getElementById("age");
const regionSelect = document.getElementById("region");
const ibanInput = document.getElementById("iban");
</script>

</body>
</html>
